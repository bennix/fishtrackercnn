<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">angle</span> = pcaangle(<span class="var type1" id="S3T2U6">x</span>, <span class="var type1" id="S4T2U7">y</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%PCAANGLE - Estimate main axis angle of a point cloud</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%  </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   ANGLE = PCAANGLE(X, Y) estimates the angle of the main axis of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   variation from the points (X,Y). If (X,Y) defines an oval point</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%   cloud, the major axis of the ellipse is found.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   ANGLE = PCAANGLE(<span class="keyword">...</span><span class="comment">, 'visualize') plots the points and the direction</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   of the main axis.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   PCAANGLE with no arguments starts a demo of the function.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="comment">%   If pcaangle is called with no arguments, the function enters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">%   demonstration mode. </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">%% AUTHOR    : J锟ger Hanseg锟rd </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="comment">%% $DATE     : 06-Dec-2004 10:13:10 $ </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="comment">%% DEVELOPED : 7.0.1.24704 (R14) Service Pack 1 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">%% FILENAME  : pcaangle.m </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="comment">%Remove the mean from the data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S3T2U10">x</span>= double(<span class="var type1" id="S3T2U13">x</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S4T2U16">y</span>= double(<span class="var type1" id="S4T2U19">y</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="comment">% x = x(:)-cx;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="comment">% y = y(:)-cy;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"> <span class="mxinfo " id="T2:U10"><span class="var type1" id="S3T2U22">x</span> = <span class="mxinfo " id="T2:U12"><span class="mxinfo " id="T2:U13"><span class="var type1" id="S3T2U25">x</span>(:)</span>-<span class="mxinfo " id="T1:U15">mean(<span class="mxinfo " id="T2:U16"><span class="var type1" id="S3T2U30">x</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"> <span class="mxinfo " id="T2:U18"><span class="var type1" id="S4T2U34">y</span> = <span class="mxinfo " id="T2:U20"><span class="mxinfo " id="T2:U21"><span class="var type1" id="S4T2U37">y</span>(:)</span>-<span class="mxinfo " id="T1:U23">mean(<span class="mxinfo " id="T2:U24"><span class="var type1" id="S4T2U42">y</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="comment">%Apply PCA to retreive major axis</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T3:U26"><span class="var type1" id="S7T3U46">c</span> = <span class="mxinfo " id="T3:U28">cov(<span class="var type1" id="S3T2U49">x</span>, <span class="var type1" id="S4T2U50">y</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">[<span class="var type1" id="S9T4U54">a</span>, <span class="var type1" id="S10T4U55">ev</span>] = eig(<span class="var type1" id="S7T3U58">c</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">[<span class="var type1" id="S10T5U62">ev</span>,<span class="var type1" id="S12T6U63">ind</span>] = sort(<span class="mxinfo " id="T5:U36">diag(<span class="var type1" id="S10T4U68">ev</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="comment">%Extract the angle of the major axis</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">[<span class="var type1" id="S15T7U72">xa</span>, <span class="var type1" id="S16T7U73">ya</span>] = deal(<span class="mxinfo " id="T7:U40"><span class="var type1" id="S9T4U77">a</span>(<span class="mxinfo " id="T8:U42">1</span>,<span class="mxinfo " id="T1:U43"><span class="var type1" id="S12T6U80">ind</span>(<span class="mxinfo " id="T8:U45">end</span>)</span>)</span>, <span class="mxinfo " id="T7:U46"><span class="var type1" id="S9T4U84">a</span>(<span class="mxinfo " id="T8:U48">2</span>,<span class="mxinfo " id="T1:U49"><span class="var type1" id="S12T6U87">ind</span>(<span class="mxinfo " id="T8:U51">end</span>)</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T1:U52"><span class="var type1" id="S2T1U92">angle</span> = <span class="mxinfo " id="T1:U54"><span class="mxinfo " id="T1:U55"><span class="mxinfo " id="T1:U56">cart2pol(<span class="mxinfo " id="T1:U57">real(<span class="var type1" id="S15T7U99">xa</span>)</span>, <span class="mxinfo " id="T1:U59">real(<span class="var type1" id="S16T7U102">ya</span>)</span>)</span>/<span class="mxinfo " id="T1:U61">pi</span></span>*<span class="mxinfo " id="T1:U62">180</span></span></span>;</span></span>
</pre>
